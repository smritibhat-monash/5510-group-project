---
title: "Alcohol Consumption Patterns"
output:
  flexdashboard::flex_dashboard:
    theme: bootstrap
    orientation: columns
    vertical_layout: scroll
    runtime: shiny
---
   

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
library(knitr)
library(tidyverse)
library(dplyr)
library(ggplot2)
library(maps)
library(plotly)
library(flexdashboard)
library(kableExtra)
library(shiny)
library(gridExtra)
library(ggiraph)
```

Introduction {.tabset}
======================

Column {.tabset} {data-width=650}
-------------------------------------

### Background




Column {.tabset} {data-width=200}
-------------------------------------

### Approach of Project

The report will be collating specific sections of this data pertaining to countrywise policy responses, consumption pattern, youth and alcohol, levels of consumption and harms and consequences.

### Information on Data

This report is being created using the data from the GISAH (Global Information System on Alcohol and Health) tool of the World Health Organisation. GISAH tool helps monitor trends relating to alcohol consumption across various age groups, side effects (harm caused) as well as the policy responses by different countries.

### Makers

**Team Name: Hayaku**

_Researchers:_

- _Kexin Xu_
- _Smriti Vinayak Bhat_
- _Yalong liu_
- _Yin Shan Ho_


Popularity {.tabset} 
======================


Cause of Mortality {.tabset} 
======================

Policy Pattern {.tabset}
======================

```{r read_data}
policy_pattern <- read_csv("../clean_data/policy_pattern.csv")
consumption_pattern <- read_csv("../clean_data/consumption_pattern.csv")
```

```{r}

policy_country_group <- policy_pattern %>%
  pivot_longer(cols = c("2010", "2011", "2012", "2013", "2014","2015", "2016"),
               names_to = "Year",
               values_to = "Action")

policy_country_group_plot <-  policy_country_group %>%
  group_by(`Action Area`,Year) %>%
  tally() %>%
  arrange(Year)

policy_country_group_2010 <- policy_pattern %>%
  select(Country, `Action Area`, "2010") %>%
  na.omit()

policy_country_group_2011 <- policy_pattern %>%
  select(Country, `Action Area`, "2011") %>%
  na.omit()

policy_country_group_2012 <- policy_pattern %>%
  select(Country, `Action Area`, "2012") %>%
  na.omit()

policy_country_group_2013 <- policy_pattern %>%
  select(Country, `Action Area`, "2013") %>%
  na.omit()

policy_country_group_2014 <- policy_pattern %>%
  select(Country, `Action Area`, "2014") %>%
  na.omit()

policy_country_group_2015 <- policy_pattern %>%
  select(Country, `Action Area`, "2015") %>%
  na.omit()

policy_country_group_2016 <- policy_pattern %>%
  select(Country, `Action Area`, "2016") %>%
  na.omit()
```


Age Restrictions {.tabset}
======================

```{r}
BAC_limits_tidy <- read_csv(here::here("clean_data/BAC_limits_tidy.csv"))
Age_limits_tidy <- read_csv(here::here("clean_data/Age_limits_tidy.csv"))
current_drinkers_15_19_tidy <- read_csv(here::here("clean_data/current_drinkers_15_19_tidy.csv"))
heavy_drinkers_15_19_tidy <- read_csv(here::here("clean_data/heavy_drinkers_15_19_tidy.csv"))
```

```{r}
limits <- BAC_limits_tidy %>% 
  left_join(Age_limits_tidy) %>% 
  left_join(current_drinkers_15_19_tidy) %>% 
  left_join(heavy_drinkers_15_19_tidy) %>% 
  rename("Age_limit" = limit)
limits1 <- limits %>% 
  mutate(Age_limit = tolower(Age_limit),
         BAC_limits = tolower(BAC_limits)) %>% 
  filter(gender == "All") %>% 
  filter(!str_detect(Age_limit, "no data"),
         !str_detect(Service, "service")) %>% 
  mutate(Age_limit = ifelse(Age_limit == "total ban", "99", Age_limit), 
         Age_limit = ifelse(Age_limit == "none", "0", Age_limit),
         Age_limit = ifelse(Age_limit == "subnational", "18", Age_limit)) %>% 
  mutate(Age_limit = as.numeric(Age_limit)) %>% 
  mutate(country = ifelse(country == "Russian Federation", "Russia", country),
         country = ifelse(country == "Iran (Islamic Republic of)", "Iran", country),
         country = ifelse(country == "United States of America", "USA", country),
         country = ifelse(country == "Venezuela (Bolivarian Republic of)", "Venezuela", country),
         country = ifelse(country == "Viet Nam", "Vietnam", country),
         country = ifelse(country == "United Kingdom of Great Britain and Northern Ireland", "UK", country),
         country = ifelse(country == "Czechia", "Czech Republic", country),
         country = ifelse(country == "Congo", "Democratic Republic of the Congo", country),
         country = ifelse(country == "United Republic of Tanzania", "Tanzania", country))

limits2 <- limits1 %>% 
  group_by(country) %>% 
  summarise(Age_limit = min(Age_limit)) 
  
limits_tidy <- limits1 %>% 
  select(country, BAC_limits, drinker_percentage, heavy_drinker_percentage) %>% 
  group_by(country) %>% 
  distinct() %>% 
  full_join(limits2) %>% 
  mutate(BAC_limits = factor(BAC_limits, 
                            levels = c("none", "0.08%", "0.07%", "0.06%", "0.05%", "0.04%", "0.03%", "0.02%", "0.01%", "zero tolerance", "total ban"))) %>% 
  mutate(Age_limit = factor(Age_limit, 
                            levels = as.character(c("0", "16", "17", "18", "20", "21", "25", "99"))))
```

```{r}
world_map <- map_data("world") %>%
  right_join(limits_tidy, 
            by = c("region" = "country")) %>%
  select(-subregion)
worldMaps <- function(data_type){
if(data_type == "drinker_percentage") 
  {
  p <- world_map %>%
  ggplot(aes(x = long, 
             y = lat, 
             group = group,
             text = region)) +
  geom_polygon(aes(fill = drinker_percentage), 
               colour = "gray50") +
  scale_x_continuous(breaks = seq(-180, 210, 45)) +
  scale_y_continuous(breaks = seq(-60, 100, 30)) +
  labs(x = "Longitude", 
       y = "Latitude") +
  theme_light()
  
  
}
  else if(data_type == "heavy_drinker_percentage") {
    
  p <- world_map %>%
  ggplot(aes(x = long, 
             y = lat, 
             group = group,
             text = region)) +
  geom_polygon(aes(fill = heavy_drinker_percentage), 
               colour = "gray50") +
  scale_x_continuous(breaks = seq(-180, 210, 45)) +
  scale_y_continuous(breaks = seq(-60, 100, 30)) +
  labs(x = "Longitude", 
       y = "Latitude") +
  theme_light()
  
  
  }
  else if(data_type == "BAC_limits") {
    
  p <- world_map %>%
  ggplot(aes(x = long, 
             y = lat, 
             group = group,
             text = region)) +
  geom_polygon(aes(fill = BAC_limits), 
               colour = "gray50") +
  scale_x_continuous(breaks = seq(-180, 210, 45)) +
  scale_y_continuous(breaks = seq(-60, 100, 30)) +
  labs(x = "Longitude", 
       y = "Latitude") +
  theme_light()
  
  }
  else {
    
  p <- world_map %>%
  ggplot(aes(x = long, 
             y = lat, 
             group = group,
             text = region)) +
  geom_polygon(aes(fill = Age_limit), 
               colour = "gray50") +
  scale_x_continuous(breaks = seq(-180, 210, 45)) +
  scale_y_continuous(breaks = seq(-60, 100, 30)) +
  labs(x = "Longitude", 
       y = "Latitude") +
  theme_light()

  }
  
  return(p)
}

```


```{r}
ui <- fluidPage(
    selectInput("variable", "Variable:",
                c("drinker_percentage" = "drinker_percentage", "heavy_drinker_percentage" = "heavy_drinker_percentage", "Age_limit" = "Age_limit", "BAC_limits" = "BAC_limits")),
    mainPanel(plotOutput(outputId = "plot_output"))
  )
server <- function(input,output,session) {
    output$plot_output <- renderPlot({
      worldMaps(input$variable)
    })
  }
shinyApp(ui=ui, server=server, options = list(height = 500), enableBookmarking = "server")
```



```{r eval = FALSE}
library(bsselectR)
map_plots <- (list(c(map1, map2), full.names = TRUE))

bsselect(map_plots, type = "img", 
         live_search = TRUE, show_tick = TRUE)
```

Column {data-width: 500}
------------------

### Analysis

It is shown in youth drinkers percentage that most countries in the Middle East, as well as some in West Africa, have significantly lower rates of youth drinking than other regions while USA, Argentina, Australia and European countries illustrate roughly high proportion. Most of age restrictions in the Mid East countries like Saudi Arabia, Sudan, Iran are "total ban" which is one reason for less drinkers. However, it is found that there is no clear correlation between age restrictions and drinkers percentage in the rest countries. Readings of the literature found that the countries with significantly lower rates of drinking were all Muslim, which strictly prohibits alcohol. On the contrast, most countries with high drinkers proportion have a rich drinking culture and some are also rich in wine.

Heavy drinkers percentage based on drinkers indicates obvious higher rates in Russia and some African countries. There are several factors that can contribute to alcohol abuse, like economic depression, national character, drinking culture, natural cold etc. BAC restrictions, which are more relaxed in countries in central and western Africa, may also be contributing to the increase in teenage binge drinking.




Youth Inebriation {.tabset}
======================

```{r}
at_least_once_a_week_tidy <- read_csv(here::here("clean_data/at_least_once_a_week_tidy.csv"))
first_drink_earlier_than_13_tidy <- read_csv(here::here("clean_data/first_drink_earlier_than_13_tidy.csv"))
any_alcohol_in_past_12_months_tidy <- read_csv(here::here("clean_data/any_alcohol_in_past_12_months_tidy.csv"))
any_alcohol_in_past_30_days_tidy <- read_csv(here::here("clean_data/any_alcohol_in_past_30_days_tidy.csv"))
```

```{r}
youth_drinking1 <- first_drink_earlier_than_13_tidy %>% 
  filter(!gender == "All") %>% 
  full_join(at_least_once_a_week_tidy, 
            by = c("country", "year", "gender")) %>% 
  rename("first_drink_earlier_than_13_percentage" = percentage.x,
         "at_least_once_a_week_percentage" = percentage.y) %>% 
  filter(!is.na(first_drink_earlier_than_13_percentage),
         !is.na(at_least_once_a_week_percentage)) %>% 
  group_by(country, gender) %>%
  summarise(first_drink_earlier_than_13_mean = mean(first_drink_earlier_than_13_percentage),
            at_least_once_a_week_mean = mean(at_least_once_a_week_percentage))

```


```{r}
youth_drinking2 <- any_alcohol_in_past_12_months_tidy %>% 
  filter(!str_detect(gender, "All"),
         !is.na(percentage)) %>% 
  group_by(country, gender) %>% 
  summarise(any_alcohol_in_past_12_months_mean = mean(percentage))

youth_drinking3 <- any_alcohol_in_past_30_days_tidy %>% 
  filter(!str_detect(gender, "All"),
         !is.na(percentage)) %>% 
  group_by(country, gender) %>% 
  summarise(any_alcohol_in_past_30_days_mean = mean(percentage))
```

```{r}
youth_drinking <- youth_drinking1 %>% 
  left_join(youth_drinking2) %>%
  left_join(youth_drinking3) %>% 
  filter(!is.na(any_alcohol_in_past_12_months_mean),
         !is.na(any_alcohol_in_past_30_days_mean)) %>% 
  select(-first_drink_earlier_than_13_mean) %>% 
  pivot_longer(cols = -c(country, gender),
               names_to = "frequency",
               values_to = "percentage")

youth_drinking$frequency <- factor(youth_drinking$frequency, levels = c("at_least_once_a_week_mean", "any_alcohol_in_past_30_days_mean", "any_alcohol_in_past_12_months_mean"))
```

```{r}
freq <- youth_drinking %>% 
  ggplot(aes(x = percentage,
             y = reorder(country, desc(percentage)),
             fill = gender)) +
  geom_col() +
  facet_grid(~frequency, scales = "free_x") +
  scale_y_discrete(labels = NULL) +
  labs(y = "") +
  theme_bw()

ggplotly(freq)
```


The plots above are based on 15 year-old teenagers. Most of the countries in the data are in Europe as Europe is a region well-known for its wine culture. It is clearly shown that teenagers in Northern Europe drink obvious the least. Take the Czech Republic and Denmark, where drinking frequencies are relatively high, as an example. According to a European study (ESPAD), the Czech Republic is the top drinker in the world, not only because alcoholic drinks taste awesome, but also due to the cheapest price among all drinks, even cheaper than mineral water and Coke. Besides, the study also revealed that Danish children are the most enthusiastic drinkers while Icelandic teenagers are not being attracted to addictive substances.



Limitations {.tabset}
======================


References {.tabset}
======================

GHO | global information system on alcohol and Health (gisah) | global information system on alcohol and health. (n.d.). Retrieved May 09, 2021, from https://apps.who.int/gho/data/node.gisah.GISAH?lang=en&amp;showonly=GISAH
---
title: "Cleaning the Data"
author: "Hayaku"
date: "03/05/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(dplyr)
library(tidyverse)
library(unglue)
```


# Research Question No. 1

**How has the popularity of each type of alcohol changed over the years for different countries and have the local favorites of earlier decades been overtaken by other types of alcohol in terms of consumption?**

_Researcher: Yalong Liu_

## Description of Data

All data sets are downloaded from the [**Global Information System on Alcohol and Health (GISAH)**](https://apps.who.int/gho/data/node.gisah.GISAH?showonly=GISAH) tool of the WHO.

This research question contains two main parts:

1. Levels of alcohol consumption by countries overtime

  - Data sets are downloaded from [Levels of Consumption](@https://apps.who.int/gho/data/node.gisah.A1022?lang=en&showonly=GISAH) section of the GISAH, and the recorded timelines include [2010-2018](https://apps.who.int/gho/data/node.gisah.A1039?lang=en&showonly=GISAH),
  [2000-2009](https://apps.who.int/gho/data/node.gisah.A1026?lang=en&showonly=GISAH),
  [1980-1999](https://apps.who.int/gho/data/node.gisah.A1024?lang=en&showonly=GISAH),
  [1960-1979](https://apps.who.int/gho/data/node.gisah.A1025?lang=en&showonly=GISAH).
  
  - These data sets record the per capita (15+ years) alcohol consumption (in litres of pure alcohol) of each type of alcohol and alcoholic beverages in countries around the world from 1960 to 2018.
  
2. Changes in the types of popular alcoholic beverages

  - Data set [Total consumption](https://apps.who.int/gho/data/node.gisah.A1029SDG3?lang=en&showonly=GISAH) is downloaded from [Levels of Consumption](@https://apps.who.int/gho/data/node.gisah.A1022?lang=en&showonly=GISAH) section of the GISAH.

  - This data set records the total per capita consumption (15+ years) of alcoholic beverages (in pure alcohol as a unit) from 2000 to 2018.

## Reading the Data

### Reading the data to obtain each periods of consumption of alcohol

This section contains the code to read in data of the consumption of different alcoholic beverages per capita in the world for the years 1960-2018.

```{r}
consumption_2010_2018_r <- read_csv("../data/consumption_2010-2018.csv")
consumption_2000_2009_r <- read_csv("../data/consumption_2000-2009.csv")
consumption_1980_1999_r <- read_csv("../data/consumption_1980-1999.csv")
consumption_1960_1979_r <- read_csv("../data/consumption_1960-1979.csv")
```

### Reading the data to acquire total consumption of alcohol

This section contains the code to read in data of the total consumption of alcoholic beverages per capita by country and gender from 2000 to 2018.

```{r}
consumption_gender_r <- read_csv("../data/consumption_gender.csv")
```

## Cleaning the Data

### Cleaning the data of all recorded timelines

The question to be researched is the trend of each type of alcohol in different countries. We need to connect the timelines of different data sets for observation.

1. Cleaning the raw data set of consumption from 2010 to 2018.

```{r}
consumption_2010_2018_t <- consumption_2010_2018_r %>%
  rename("Country" = X1,
         "Data_sourse" = X2,
         "Beverage_Types" = X3, 
         "2018" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)`, 
         "2017" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_1`,
         "2016" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_2`,
         "2015" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_3`,
         "2014" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_4`,
         "2013" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_5`,
         "2012" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_6`,
         "2011" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_7`,
         "2010" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_8`) %>%
  filter(!str_detect(Country,"Country")) %>%
  select(-"Data_sourse")
```

2. Cleaning the raw data set of consumption from 2000 to 2009.

```{r}
consumption_2000_2009_t <- consumption_2000_2009_r %>%
  rename("Country" = X1,
         "Data_sourse" = X2,
         "Beverage_Types" = X3, 
         "2009" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)`, 
         "2008" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_1`,
         "2007" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_2`,
         "2006" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_3`,
         "2005" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_4`,
         "2004" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_5`,
         "2003" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_6`,
         "2002" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_7`,
         "2001" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_8`,
         "2000" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_9`) %>%
  filter(!str_detect(Country,"Country")) %>%
  select(-"Data_sourse")
```

3. Cleaning the raw data set of consumption from 1980 to 1999.

```{r}
consumption_1980_1999_t <- consumption_1980_1999_r %>%
  rename("Country" = X1,
         "Data_sourse" = X2,
         "Beverage_Types" = X3, 
         "1999" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)`, 
         "1998" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_1`,
         "1997" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_2`,
         "1996" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_3`,
         "1995" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_4`,
         "1994" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_5`,
         "1993" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_6`,
         "1992" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_7`,
         "1991" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_8`,
         "1990" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_9`,
         "1989" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_10`,
         "1988" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_11`,
         "1987" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_12`,
         "1986" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_13`,
         "1985" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_14`,
         "1984" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_15`,
         "1983" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_16`,
         "1982" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_17`,
         "1981" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_18`,
         "1980" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_19`) %>%
  filter(!str_detect(Country,"Country")) %>%
  select(-"Data_sourse")
```

4. Cleaning the raw data set of consumption from 1960 to 1979.

```{r}
consumption_1960_1979_t <- consumption_1960_1979_r %>%
  rename("Country" = X1,
         "Data_sourse" = X2,
         "Beverage_Types" = X3, 
         "1979" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)`, 
         "1978" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_1`,
         "1977" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_2`,
         "1976" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_3`,
         "1975" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_4`,
         "1974" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_5`,
         "1973" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_6`,
         "1972" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_7`,
         "1971" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_8`,
         "1970" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_9`,
         "1969" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_10`,
         "1968" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_11`,
         "1967" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_12`,
         "1966" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_13`,
         "1965" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_14`,
         "1964" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_15`,
         "1963" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_16`,
         "1962" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_17`,
         "1961" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_18`,
         "1960" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_19`) %>%
  filter(!str_detect(Country,"Country")) %>%
  select(-"Data_sourse")
```

5. Combining all time periods and making null values consistent.

```{r}
consumption_join <- full_join(consumption_2010_2018_t,
                                   consumption_2000_2009_t,
                                   by=c("Country", "Beverage_Types")) %>%
  full_join(consumption_1980_1999_t,by=c("Country", "Beverage_Types")) %>%
  full_join(consumption_1960_1979_t,by=c("Country", "Beverage_Types")) %>%
  arrange(Country)
```

```{r}
consumption_join[is.na(consumption_join)] <- 0
```

### Cleaning the data by gender

This data is used to view the total alcohol consumption per capita of different genders in various countries in recent years, so it is necessary to meet the requirements of screening by gender and timeline at the same time.

```{r}
consumption_gender_t <- consumption_gender_r %>%
  rename("Country" = X1,
         "Both_18" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)`,
         "Male_18" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_1`,
         "Female_18" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_2`,
         "Both_15" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_3`,
         "Male_15" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_4`,
         "Female_15" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_5`,
         "Both_10" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_6`,
         "Male_10" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_7`,
         "Female_10" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_8`,
         "Both_05" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_9`,
         "Male_05" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_10`,
         "Female_05" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_11`,
         "Both_00" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_12`,
         "Male_00" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_13`,
         "Female_00" = `Alcohol, total per capita (15+) consumption (in litres of pure alcohol) (SDG Indicator 3.5.2)_14`) %>%
  filter(!(Country == c("NA", "Country")))
```

```{r}
consumption_g18 <- consumption_gender_t[,c(1,2,3,4)] %>%
  pivot_longer(cols = c("Both_18", "Male_18", "Female_18"),
               names_to = "Gender",
               values_to = "2018") %>%
  separate(col = Gender, into = c("Gender", "Year"), "_") %>%
  select(-Year)

consumption_g15 <- consumption_gender_t[,c(1,5,6,7)] %>%
  pivot_longer(cols = c("Both_15", "Male_15", "Female_15"),
               names_to = "Gender",
               values_to = "2015")  %>%
  separate(col = Gender, into = c("Gender", "Year"), "_") %>%
  select(-Year)

consumption_g10 <- consumption_gender_t[,c(1,8,9,10)] %>%
  pivot_longer(cols = c("Both_10", "Male_10", "Female_10"),
               names_to = "Gender",
               values_to = "2010")  %>%
  separate(col = Gender, into = c("Gender", "Year"), "_") %>%
  select(-Year)

consumption_g05 <- consumption_gender_t[,c(1,11,12,13)] %>%
  pivot_longer(cols = c("Both_05", "Male_05", "Female_05"),
               names_to = "Gender",
               values_to = "2005")  %>%
  separate(col = Gender, into = c("Gender", "Year"), "_") %>%
  select(-Year)

consumption_g00 <- consumption_gender_t[,c(1,14,15,16)] %>%
  pivot_longer(cols = c("Both_00", "Male_00", "Female_00"),
               names_to = "Gender",
               values_to = "2000")  %>%
  separate(col = Gender, into = c("Gender", "Year"), "_") %>%
  select(-Year)
```

```{r}
consumption_gender <- full_join(consumption_g18,
                                   consumption_g15,
                                   by=c("Country", "Gender"))%>%
  full_join(consumption_g10,by=c("Country", "Gender")) %>%
  full_join(consumption_g05,by=c("Country", "Gender")) %>%
  full_join(consumption_g00,by=c("Country", "Gender")) %>%
  arrange(Country)
```

Combine this data set with the data set in the first part to explore whether alcoholic beverages are substituted.

## Storing Cleaned Data Sets

```{r}
write_csv(consumption_join, "../clean_data/consumption_join.csv")
write_csv(consumption_gender, "../clean_data/consumption_gender.csv")
```

# Research Question No. 2
**Does alcohol take more lives in traffic crashes or illnesses and which countries suffer more from alcohol-related cases?**

_Researcher: Yin Shan Ho_

## Description of Data

The data sets are downloaded from the [**Global Information System on Alcohol and Health (GISAH)**](https://apps.who.int/gho/data/node.gisah.GISAH?showonly=GISAH) tool of the WHO.

The data sets are separated into two parts:

1. The age-standardized death rate in:
- [cancer](https://apps.who.int/gho/data/node.gisah.A1110?lang=en&showonly=GISAH), 
[liver cirrhosis](https://apps.who.int/gho/data/node.gisah.A1092?lang=en&showonly=GISAH),
[road traffic injuries](https://apps.who.int/gho/data/node.gisah.A1077?lang=en&showonly=GISAH).

- The data contains the global observation of the death rate per 100,000 population caused by road injuries, cancers, liver cirrhosis for 194 countries in 2016.

2. The death rate of alcohol attributed cases in: 
- [cancer](https://apps.who.int/gho/data/node.gisah.A1098?lang=en&showonly=GISAH), 
[liver cirrhosis](https://apps.who.int/gho/data/node.gisah.A1094?lang=en&showonly=GISAH),
[road traffic crash](https://apps.who.int/gho/data/node.gisah.A1077?lang=en&showonly=GISAH).

- The data indicates the death rate of alcohol-related road injuries, cancers, liver cirrhosis for 194 countries in 2016.


## Reading the data

This section contains the code to read in data of the number of deaths per 100,000 population and the rate of alcohol attributed deaths caused by cancers, liver cirrhosis and traffic crashes in 2016. 

```{r}
cancer_alcohol <- read_csv("../data/cancer_alcohol.csv")
liver_alcohol <- read_csv("../data/liver_alcohol.csv")
traffic_alcohol <- read_csv("../data/traffic_alcohol.csv")
cancer_death <- read_csv("../data/cancer_death.csv")
liver_death <- read_csv("../data/liver_death.csv")
traffic_death <- read_csv("../data/traffic_death.csv")
```


## Cleaning the data

### Alcohol-attributed deaths

As the research question aims to compare whether alcohol cause more deaths in illnesses or road traffic crashes, several manipulations were done to get the rate of alcohol-attributed deaths. The steps are as follow:

1. Rename the variables 

2. Filter the cells which contain "No data"

3. Pivot longer is used to make data sets longer and to combine the separated variables on gender into one for future calculations. 

```{r clean-cancer-alcohol}
cancer_a <- tail(cancer_alcohol, -2) %>% 
  rename(Country = X1, 
         male = `Alcohol-attributable fractions (15+), cancer deaths`,
         female = `Alcohol-attributable fractions (15+), cancer deaths_1`) %>% 
  filter(!str_detect(male, "No data"))

cancer_a_clean <- pivot_longer(cancer_a, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "alc-attri-death-cancer")
```


```{r clean-liver-alcohol}
liver_a <- tail(liver_alcohol, -2) %>% 
  rename(Country = X1, 
         male = `Alcohol-attributable fractions (15+), liver cirrhosis deaths (%)`,
         female = `Alcohol-attributable fractions (15+), liver cirrhosis deaths (%)_1`) %>% 
  filter(!str_detect(male, "No data"))

liver_a_clean <- pivot_longer(liver_a, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "alc-attri-death-liver")
```


```{r clean-traffic-alcohol}
traffic_a <- tail(traffic_alcohol, -2) %>% 
  rename(Country = X1, 
         male = `Alcohol-attributable fractions (15+), road traffic crash deaths (%)`,
         female = `Alcohol-attributable fractions (15+), road traffic crash deaths (%)_1`) %>% 
  filter(!str_detect(male, "No data"))

traffic_a_clean <- pivot_longer(traffic_a, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "alc-attri-death-traffic")
```


### Number of death per 100,000 population  

To calculate the number of alcohol attributed deaths, the total number of deaths in these three aspects needed to be extracted. 
The way to manipulate this data set is exactly the same as the previous one. 

```{r clean-cancer-death}
cancer_d <- tail(cancer_death, -2) %>% 
  rename(Country = X1, 
         male = `Cancer, age-standardized death rates (15+), per 100,000 population`,
         female = `Cancer, age-standardized death rates (15+), per 100,000 population_1`) %>% 
  filter(!str_detect(male, "No data"))

cancer_d_clean <- pivot_longer(cancer_d, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "cancer-death-population")
```


```{r clean-liver-death}
liver_d <- tail(liver_death, -2) %>% 
  rename(Country = X1, 
         male = `Liver cirrhosis, age-standardized death rates (15+), per 100,000 population`,
         female = `Liver cirrhosis, age-standardized death rates (15+), per 100,000 population_1`) %>% 
  filter(!str_detect(male, "No data"))

liver_d_clean <- pivot_longer(liver_d, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "liver-cirrhosis-death-population")
```


```{r clean-traffic-death}
traffic_d <- tail(traffic_death, -2) %>% 
  rename(Country = X1, 
         male = `Road traffic injuries, age-standardized death rates (15+), per 100,000 population`,
         female = `Road traffic injuries, age-standardized death rates (15+), per 100,000 population_1`) %>% 
  filter(!str_detect(male, "No data"))

traffic_d_clean <- pivot_longer(traffic_d, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "road-traffic-death-population")
```

## Storing the cleaned Data Sets

Saving the data sets into csv:

```{r}
write_csv(cancer_a_clean, "../clean_data/cancer_a_clean.csv")
write_csv(cancer_d_clean, "../clean_data/cancer_d_clean.csv")
write_csv(liver_a_clean, "../clean_data/liver_a_clean.csv")
write_csv(liver_d_clean, "../clean_data/liver_d_clean.csv")
write_csv(traffic_a_clean, "../clean_data/traffic_a_clean.csv")
write_csv(traffic_d_clean, "../clean_data/traffic_d_clean.csv")
```


# Research Question No. 3

**What are the recurring patterns of policy responses across different countries in the world and how has it impacted the consumption of alcohol?**

_Researcher: Smriti Vinayak Bhat_

## Description of Data

There are multiple data sets downloaded from the [**Global Information System on Alcohol and Health (GISAH)**](https://apps.who.int/gho/data/node.gisah.GISAH?showonly=GISAH) tool of WHO.

It is split into two main parts:

1. Consumption pattern data -
  - This data has been downloaded from [Levels of Consumption](@https://apps.who.int/gho/data/node.gisah.A1022?lang=en&showonly=GISAH) section of the GISAH tool.
  - This conists of alcohol per capita consumption from 2010 onward by country, type of beverage and alcohol, recorded per capita (15+ years) consumption (in litres of pure alcohol).

2. Alcohol policy timeline database -
  - This data contains Alcohol Policy Timeline Database of [WHO African Region](@https://apps.who.int/gho/data/node.gisah.A1700?lang=en&showonly=GISAH,) [WHO Region of the Americas](@https://apps.who.int/gho/data/node.gisah.A1600?lang=en&showonly=GISAH), [WHO European Region](@https://apps.who.int/gho/data/node.gisah.A1500?lang=en&showonly=GISAH), [WHO Eastern Mediterranean Region](@https://apps.who.int/gho/data/node.gisah.A1800?lang=en&showonly=GISAH), [WHO South-East Asian Region](@https://apps.who.int/gho/data/node.gisah.A2000?lang=en&showonly=GISAH) and [WHO Western Pacific Region](@https://apps.who.int/gho/data/node.gisah.A1900?lang=en&showonly=GISAH).
  - It contains the country, action area and policy changes done in each country according to year.
  
**Both these sets of data are being used to track the trend from 2010-2016**


## Reading in Data

### Reading in Data of Policy Responses Worldwide

This section contains the code to read in data of policy responses to the problem of alcoholism from different parts of the world for the years 2010-2016.

```{r}
file_path <- ("../data/{geo}/")
csv_africa_paths <- glue::glue(file_path, "{geo}_{alpha}.csv", 
                        geo = c("africa"), 
                        alpha = c("2010", "2011", "2012","2013","2014","2015","2016"))
csv_asia_paths <- glue::glue(file_path, "{geo}_{alpha}.csv", 
                        geo = c("asia"), 
                        alpha = c("2010", "2011", "2012","2013","2014","2015","2016"))
csv_americas_paths <- glue::glue(file_path, "{geo}_{alpha}.csv", 
                        geo = c("americas"), 
                        alpha = c("2010", "2011", "2012","2013","2014","2015","2016"))
csv_europe_paths <- glue::glue(file_path, "{geo}_{alpha}.csv", 
                        geo = c("europe"), 
                        alpha = c("2010", "2011", "2012","2013","2014","2015","2016"))
csv_med_paths <- glue::glue(file_path, "{geo}_{alpha}.csv", 
                        geo = c("med"), 
                        alpha = c("2010", "2011", "2012","2013","2014","2015","2016"))
csv_pacific_paths <- glue::glue(file_path, "{geo}_{alpha}.csv", 
                        geo = c("pacific"), 
                        alpha = c("2010", "2011", "2012","2013","2014","2015","2016"))

africa_2010 <- read_csv(csv_africa_paths[1])
africa_2011 <- read_csv(csv_africa_paths[2])
africa_2012 <- read_csv(csv_africa_paths[3])
africa_2013 <- read_csv(csv_africa_paths[4])
africa_2014 <- read_csv(csv_africa_paths[5])
africa_2015 <- read_csv(csv_africa_paths[6])
africa_2016 <- read_csv(csv_africa_paths[7])

americas_2010 <- read_csv(csv_americas_paths[1])
americas_2011 <- read_csv(csv_americas_paths[2])
americas_2012 <- read_csv(csv_americas_paths[3])
americas_2013 <- read_csv(csv_americas_paths[4])
americas_2014 <- read_csv(csv_americas_paths[5])
americas_2015 <- read_csv(csv_americas_paths[6])
americas_2016 <- read_csv(csv_americas_paths[7])

europe_2010 <- read_csv(csv_europe_paths[1])
europe_2011 <- read_csv(csv_europe_paths[2])
europe_2012 <- read_csv(csv_europe_paths[3])
europe_2013 <- read_csv(csv_europe_paths[4])
europe_2014 <- read_csv(csv_europe_paths[5])
europe_2015 <- read_csv(csv_europe_paths[6])
europe_2016 <- read_csv(csv_europe_paths[7])

asia_2010 <- read_csv(csv_asia_paths[1])
asia_2011 <- read_csv(csv_asia_paths[2])
asia_2012 <- read_csv(csv_asia_paths[3])
asia_2013 <- read_csv(csv_asia_paths[4])
asia_2014 <- read_csv(csv_asia_paths[5])
asia_2015 <- read_csv(csv_asia_paths[6])
asia_2016 <- read_csv(csv_asia_paths[7])

med_2010 <- read_csv(csv_med_paths[1])
med_2011 <- read_csv(csv_med_paths[2])
med_2012 <- read_csv(csv_med_paths[3])
med_2013 <- read_csv(csv_med_paths[4])
med_2014 <- read_csv(csv_med_paths[5])
med_2015 <- read_csv(csv_med_paths[6])
med_2016 <- read_csv(csv_med_paths[7])

pacific_2010 <- read_csv(csv_pacific_paths[1])
pacific_2011 <- read_csv(csv_pacific_paths[2])
pacific_2012 <- read_csv(csv_pacific_paths[3])
pacific_2013 <- read_csv(csv_pacific_paths[4])
pacific_2014 <- read_csv(csv_pacific_paths[5])
pacific_2015 <- read_csv(csv_pacific_paths[6])
pacific_2016 <- read_csv(csv_pacific_paths[7])
```

### Reading in Data Required to Check Consumption of Alcohol

This section contains the code to read in data which will help track worldwide consumption of alcohol

```{r}
consumption_pattern <- read_csv("../data/consumption_pattern.csv")
```

## Cleaning the data

### Cleaning Data Pertaining to Policy Responses

Since the research question aims to only look at changes due to policy responses, in this step the code will be written to remove all values where no policy response has been done or the data is not available.

The below code cleans data for Africa. 
```{r}
africa_2010 <- africa_2010 %>%
  filter(!(`2010` == "No data")) %>%
  na.omit()

africa_2011 <- africa_2011 %>%
  filter(!(`2011` == "No data")) %>%
  na.omit()

africa_2012 <- africa_2012 %>%
  filter(!(`2012` == "No data")) %>%
  na.omit()

africa_2013 <- africa_2013 %>%
  filter(!(`2013` == "No data")) %>%
  na.omit()

africa_2014 <- africa_2014 %>%
  filter(!(`2014` == "No data")) %>%
  na.omit()

africa_2015 <- africa_2015 %>%
  filter(!(`2015` == "No data")) %>%
  na.omit()

africa_2016 <- africa_2016 %>%
  filter(!(`2016` == "No data")) %>%
  na.omit()
```

The below code cleans data for the Americas. 
```{r}
americas_2010 <- americas_2010 %>%
  filter(!(`2010` == "No data")) %>%
  na.omit()

americas_2011 <- americas_2011 %>%
  filter(!(`2011` == "No data")) %>%
  na.omit()

americas_2012 <- americas_2012 %>%
  filter(!(`2012` == "No data")) %>%
  na.omit()

americas_2013 <- americas_2013 %>%
  filter(!(`2013` == "No data")) %>%
  na.omit()

americas_2014 <- americas_2014 %>%
  filter(!(`2014` == "No data")) %>%
  na.omit()

americas_2015 <- americas_2015 %>%
  filter(!(`2015` == "No data")) %>%
  na.omit()

americas_2016 <- americas_2016 %>%
  filter(!(`2016` == "No data")) %>%
  na.omit()
```

The below code cleans data for Asia. 
```{r}
asia_2010 <- asia_2010 %>%
  filter(!(`2010` == "No data")) %>%
  na.omit()

asia_2011 <- asia_2011 %>%
  filter(!(`2011` == "No data")) %>%
  na.omit()

asia_2012 <- asia_2012 %>%
  filter(!(`2012` == "No data")) %>%
  na.omit()

asia_2013 <- asia_2013 %>%
  filter(!(`2013` == "No data")) %>%
  na.omit()

asia_2014 <- asia_2014 %>%
  filter(!(`2014` == "No data")) %>%
  na.omit()

asia_2015 <- asia_2015 %>%
  filter(!(`2015` == "No data")) %>%
  na.omit()

asia_2016 <- asia_2016 %>%
  filter(!(`2016` == "No data")) %>%
  na.omit()
```

The below code cleans data for Europe. 
```{r}
europe_2010 <- europe_2010 %>%
  filter(!(`2010` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()

europe_2011 <- europe_2011 %>%
  filter(!(`2011` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()

europe_2012 <- europe_2012 %>%
  filter(!(`2012` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()

europe_2013 <- europe_2013 %>%
  filter(!(`2013` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()

europe_2014 <- europe_2014 %>%
  filter(!(`2014` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()

europe_2015 <- europe_2015 %>%
  filter(!(`2015` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()

europe_2016 <- europe_2016 %>%
  filter(!(`2016` == "No data")) %>%
  select(-`Data Source`) %>%
  na.omit()
```

The below code cleans data for Mediterranean. 
```{r}
med_2010 <- med_2010 %>%
  filter(!(`2010` == "No data")) %>%
  na.omit()

med_2011 <- med_2011 %>%
  filter(!(`2011` == "No data")) %>%
  na.omit()

med_2012 <- med_2012 %>%
  filter(!(`2012` == "No data")) %>%
  na.omit()

med_2013 <- med_2013 %>%
  filter(!(`2013` == "No data")) %>%
  na.omit()

med_2014 <- med_2014 %>%
  filter(!(`2014` == "No data")) %>%
  na.omit()

med_2015 <- med_2015 %>%
  filter(!(`2015` == "No data")) %>%
  na.omit()

med_2016 <- med_2016 %>%
  filter(!(`2016` == "No data")) %>%
  na.omit()
```

The below code cleans data for the Pacific region. 
```{r}
pacific_2010 <- pacific_2010 %>%
  filter(!(`2010` == "No data")) %>%
  na.omit()

pacific_2011 <- pacific_2011 %>%
  filter(!(`2011` == "No data")) %>%
  na.omit()

pacific_2012 <- pacific_2012 %>%
  filter(!(`2012` == "No data")) %>%
  na.omit()

pacific_2013 <- pacific_2013 %>%
  filter(!(`2013` == "No data")) %>%
  na.omit()

pacific_2014 <- pacific_2014 %>%
  filter(!(`2014` == "No data")) %>%
  na.omit()

pacific_2015 <- pacific_2015 %>%
  filter(!(`2015` == "No data")) %>%
  na.omit()

pacific_2016 <- pacific_2016 %>%
  filter(!(`2016` == "No data")) %>%
  na.omit()
```

The below code chunk combines the data from all countries year wise.

```{r}
policy_pattern_africa <- full_join(africa_2010,africa_2011,by=c("Country","Action Area")) %>%
  full_join(africa_2012,by=c("Country","Action Area")) %>%
  full_join(africa_2013,by=c("Country","Action Area")) %>%
  full_join(africa_2014,by=c("Country","Action Area")) %>%
  full_join(africa_2015,by=c("Country","Action Area")) %>%
  full_join(africa_2016,by=c("Country","Action Area")) %>%
  arrange(Country) 

policy_pattern_americas <- full_join(americas_2010,americas_2011,by=c("Country","Action Area")) %>%
  full_join(americas_2012,by=c("Country","Action Area")) %>%
  full_join(americas_2013,by=c("Country","Action Area")) %>%
  full_join(americas_2014,by=c("Country","Action Area")) %>%
  full_join(americas_2015,by=c("Country","Action Area")) %>%
  full_join(americas_2016,by=c("Country","Action Area")) %>%
  arrange(Country) 

policy_pattern_asia <- full_join(asia_2010,asia_2011,by=c("Country","Action Area")) %>%
  full_join(asia_2012,by=c("Country","Action Area")) %>%
  full_join(asia_2013,by=c("Country","Action Area")) %>%
  full_join(asia_2014,by=c("Country","Action Area")) %>%
  full_join(asia_2015,by=c("Country","Action Area")) %>%
  full_join(asia_2016,by=c("Country","Action Area")) %>%
  arrange(Country)

policy_pattern_europe <- full_join(europe_2010,europe_2011,by=c("Country","Action Area")) %>%
  full_join(europe_2012,by=c("Country","Action Area")) %>%
  full_join(europe_2013,by=c("Country","Action Area")) %>%
  full_join(europe_2014,by=c("Country","Action Area")) %>%
  full_join(europe_2015,by=c("Country","Action Area")) %>%
  full_join(europe_2016,by=c("Country","Action Area")) %>%
  arrange(Country)

policy_pattern_med <- full_join(med_2010,med_2011,by=c("Country","Action Area")) %>%
  full_join(med_2012,by=c("Country","Action Area")) %>%
  full_join(med_2013,by=c("Country","Action Area")) %>%
  full_join(med_2014,by=c("Country","Action Area")) %>%
  full_join(med_2015,by=c("Country","Action Area")) %>%
  full_join(med_2016,by=c("Country","Action Area")) %>%
  arrange(Country) 

policy_pattern_pacific <- full_join(pacific_2010,pacific_2011,by=c("Country","Action Area")) %>%
  full_join(pacific_2012,by=c("Country","Action Area")) %>%
  full_join(pacific_2013,by=c("Country","Action Area")) %>%
  full_join(pacific_2014,by=c("Country","Action Area")) %>%
  full_join(pacific_2015,by=c("Country","Action Area")) %>%
  full_join(pacific_2016,by=c("Country","Action Area")) %>%
  arrange(Country) 
```

The below code binds all the countries' policy pattern together.

```{r}
policy_pattern <- rbind(policy_pattern_africa,
                        policy_pattern_americas,
                        policy_pattern_asia,
                        policy_pattern_europe,
                        policy_pattern_med,
                        policy_pattern_pacific) %>%
  arrange(Country)
```


### Cleaning the Data Pertaining to Trend of Consumption of Alcohol

1. The code renames the columns for convenience.

```{r}

consumption_pattern <- consumption_pattern %>%
  rename(Country = X1,
         `Beverage Types` = X3, 
         "2018" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)`, 
         "2017" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_1`,
         "2016" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_2`,
         "2015" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_3`,
         "2014" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_4`,
         "2013" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_5`,
         "2012" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_6`,
         "2011" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_7`,
         "2010" = `Alcohol, recorded per capita (15+) consumption (in litres of pure alcohol)_8`)
```

2. The code chunk drops the variables X2 and 2018 as we don't need data source or the trend past 2017. Since our final set of policy data dates back to 2016, we need to retain the figures of 2017 to see their effect.

```{r}
consumption_pattern <- consumption_pattern %>%
  select(-c(X2, "2018"))
```

3. The code chunk drops the first row as it is a repeat of the heading.

```{r}
consumption_pattern <- consumption_pattern %>%
  filter(!str_detect(Country,"Country"))
```

4. The code chunk removes countries for whom policy data is not present.

```{r}
consumption_pattern <- semi_join(consumption_pattern,
                                 policy_pattern,
                                 by="Country")
```

## Storing Cleaned Data Set

Saving both cleaned sets of data back into csv:

```{r}
write_csv(policy_pattern,"../clean_data/policy_pattern.csv")
write_csv(consumption_pattern,"../clean_data/consumption_pattern.csv")
```


# Research Question No. 4

**Do drinking age restrictions and legal blood alcohol concentration (BAC) limits for young drivers have any effect on adolescents’ drinking among countries?**

_Researcher: Kexin Xu_

## Description of Data
All data sets below are downloaded from [**Global Information System on Alcohol and Health (GISAH)**](https://apps.who.int/gho/data/node.gisah.GISAH?showonly=GISAH) in WHO.  

1. BAC limits
  - The data describes legal blood alcohol concentration (BAC) limits for young/novice drivers.
  - The data contains BAC restrictions in each country in year 2016.

2. Age limits
  - The data shows age limits for both alcohol sales and alcohol service.
  - The data contains age restrictions on selling and serving different types of alcohol in each country in year 2016.
  
3. Current drinkers 15-19
  - The data tells the percentage of current drinkers between 15 and 19 years old.
  - The data is consist of percentage of current young drinkers across gender in each country in year 2016.

4. Heavy drinkers 15-19
  - The data represents the percentage of heavy episodic drinkers among drinkers between 15 and 19 years old.
  - The data is consist of percentage of heavy drinkers among young drinkers across gender in each country in year 2016.

## Reading in Data
```{r}
BAC_limits_raw <- read_csv(here::here("data/Legal_blood_alcohol_concentration_(BAC)_limits_for_youngnovice_drivers.csv"))
```

```{r}
Age_limits_raw <- read_csv(here::here("data/Age_limits_Alcohol_servicesales.csv"))
```

```{r}
current_drinkers_15_19_raw <- read_csv(here::here("data/15-19_years_old_current_drinkers_(%).csv"))
```

```{r}
heavy_drinkers_15_19_raw <- read_csv(here::here("data/15-19_years_old_heavy_episodic_drinking_drinkers_only_past_30_days.csv"))
```


## Cleaning the Data
```{r}
BAC_limits_tidy <- BAC_limits_raw[-1,] %>% 
  rename("country" = X1, 
         "year" = X2, 
         "BAC_limits" = 'Legal blood alcohol concentration (BAC) limits') %>% 
  filter(!(BAC_limits == "."))
```

```{r}
Age_limits_tidy <- Age_limits_raw[-1,] %>% 
   rename("country" = X1, 
          "year" = X2, 
          "sale_beer" = 'Age limits off-premise sales',
          "sale_wine" = 'Age limits off-premise sales_1',
          "sale_spirits" = 'Age limits off-premise sales_2',
          "service_beer" = 'Age limits on-premise service',
          "service_wine" = 'Age limits on-premise service_1',
          "service_spirits" = 'Age limits on-premise service_2') %>%
  pivot_longer(cols = c(-country, -year), names_to = "type", values_to = "limit") %>%
  unglue_unnest(type,
                "{Service}_{Alcohol_Type}")
```

```{r}
current_drinkers_15_19_tidy <- current_drinkers_15_19_raw[-1,] %>% 
  rename("country" = X1, 
          "year" = X2, 
          "All" = '15-19 years old, current drinkers (%)',
          "Male" = '15-19 years old, current drinkers (%)_1',
          "Female" = '15-19 years old, current drinkers (%)_2') %>% 
  pivot_longer(cols = c(-country, -year), names_to = "gender", values_to = "percentage") %>% 
  separate(col = percentage, into = c("drinker_percentage", "range"), " ")
current_drinkers_15_19_tidy <- current_drinkers_15_19_tidy[,-5]
```

```{r}
heavy_drinkers_15_19_tidy <- heavy_drinkers_15_19_raw[-1,] %>% 
  rename("country" = X1, 
          "year" = X2, 
          "All" = 'Heavy episodic drinking (youth 15 -19 years), drinkers only, past 30 days (%)',
          "Male" = 'Heavy episodic drinking (youth 15 -19 years), drinkers only, past 30 days (%)_1',
          "Female" = 'Heavy episodic drinking (youth 15 -19 years), drinkers only, past 30 days (%)_2') %>% 
  pivot_longer(cols = c(-country, -year), names_to = "gender", values_to = "percentage") %>% 
  separate(col = percentage, into = c("heavy_drinker_percentage", "range"), " ")
heavy_drinkers_15_19_tidy <- heavy_drinkers_15_19_tidy[,-5]
```

## Storing Cleaned Data Set
```{r}
write_csv(BAC_limits_tidy, "../clean_data/BAC_limits_tidy.csv")
```

```{r}
write_csv(Age_limits_tidy, "../clean_data/Age_limits_tidy.csv")
```

```{r}
write_csv(current_drinkers_15_19_tidy, "../clean_data/current_drinkers_15_19_tidy.csv")
```

```{r}
write_csv(heavy_drinkers_15_19_tidy, "../clean_data/heavy_drinkers_15_19_tidy.csv")
```



# Research Question No. 5

**What are the trends in youth drinking issues over the years?**

_Researcher: Kexin Xu_

## Description of Data
All data sets below are downloaded from [**Global Information System on Alcohol and Health (GISAH)**](https://apps.who.int/gho/data/node.gisah.GISAH?showonly=GISAH) in WHO.  
Age of 15 is taken on behalf of youth here. The following data sets describe different drinking issues based on 15-year-old teenagers.  

1. Drink at least once a week
  - The data shows the percentage of whom has any alcoholic beverage at least once a week.
  - The data contains the percentage of 15-year-old adolescents who drinks alcoholic beverage at least once a week across gender in each country in different years.

2. First drink earlier than 13
  - The data describes the percentage of whose first drink at 13 years old or younger.
  - The data contains the percentage of 15-year-old adolescents who first drinks alcoholic beverage earlier than 13 across gender in each country in different years.
  
3. Any alcohol in past 12 months
  - The data represents the percentage of whom has any alcohol in past 12 months.
  - The data is consist of percentage of 15-year-old adolescents who any alcoholic beverage in the past year across gender in each country in different years.

4. Any alcohol in past 30 days
  - The data represents the percentage of whom has any alcohol in past 30 days.
  - The data is consist of percentage of 15-year-old adolescents who any alcoholic beverage in the past month across gender in each country in different years.

## Reading in Data
```{r}
at_least_once_a_week_raw <- read_csv(here::here("data/15_years_old_any_alcoholic_beverage_at_least_once_a_week_(%).csv"))
```

```{r}
first_drink_earlier_than_13_raw <- read_csv(here::here("data/15_years_old_first_drink_at_13_years_or_younger_(%).csv"))
```

```{r}
any_alcohol_in_past_12_months_raw <- read_csv(here::here("data/15_years_old_any_alcoholic_beverage_in_past_12_months_(%).csv"))
```

```{r}
any_alcohol_in_past_30_days_raw <- read_csv(here::here("data/15_years_old_any_alcoholic_beverage_in_past_30_days_(%).csv"))
```

## Cleaning the Data
```{r}
at_least_once_a_week_tidy <- at_least_once_a_week_raw[-1,-2] %>% 
  rename("country" = X1, 
          "year" = X3, 
          "Male" = '15-years old, any alcoholic beverage consumed at least once a week, (%)',
          "Female" = '15-years old, any alcoholic beverage consumed at least once a week, (%)_1') %>%
  pivot_longer(cols = c(-country, -year), names_to = "gender", values_to = "percentage")
```

```{r}
first_drink_earlier_than_13_tidy <- first_drink_earlier_than_13_raw[-1,-2] %>% 
  rename("country" = X1, 
          "year" = X3, 
          "All" = '15-years old first drink at 13 years or younger, (%)',
          "Male" = '15-years old first drink at 13 years or younger, (%)_1',
          "Female" = '15-years old first drink at 13 years or younger, (%)_2') %>%
  pivot_longer(cols = c(-country, -year), names_to = "gender", values_to = "percentage")
```

```{r}
any_alcohol_in_past_12_months_tidy <- any_alcohol_in_past_12_months_raw[-1,-2] %>% 
  rename("country" = X1, 
          "year" = X3, 
          "All" = '15-years old any alcoholic beverage consumed in past 12 months, (%)',
          "Male" = '15-years old any alcoholic beverage consumed in past 12 months, (%)_1',
          "Female" = '15-years old any alcoholic beverage consumed in past 12 months, (%)_2') %>%
  pivot_longer(cols = c(-country, -year), names_to = "gender", values_to = "percentage")
```

```{r}
any_alcohol_in_past_30_days_tidy <- any_alcohol_in_past_30_days_raw[-1,-2] %>% 
  rename("country" = X1, 
          "year" = X3, 
          "All" = '15-years old any alcoholic beverage consumed in past 30 days, (%)',
          "Male" = '15-years old any alcoholic beverage consumed in past 30 days, (%)_1',
          "Female" = '15-years old any alcoholic beverage consumed in past 30 days, (%)_2') %>%
  pivot_longer(cols = c(-country, -year), names_to = "gender", values_to = "percentage")
```

## Storing Cleaned Data Set
```{r}
write_csv(at_least_once_a_week_tidy, "../clean_data/at_least_once_a_week_tidy.csv")
```

```{r}
write_csv(first_drink_earlier_than_13_tidy, "../clean_data/first_drink_earlier_than_13_tidy.csv")
```

```{r}
write_csv(any_alcohol_in_past_12_months_tidy, "../clean_data/any_alcohol_in_past_12_months_tidy.csv")
```

```{r}
write_csv(any_alcohol_in_past_30_days_tidy, "../clean_data/any_alcohol_in_past_30_days_tidy.csv")
```

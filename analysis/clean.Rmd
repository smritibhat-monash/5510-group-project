---
title: "Clean Data"
author: "Shaine"
date: "03/05/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
library(tidyverse)
```

# Research Question No. 3
Does alcohol take more lives in traffic crashes or illnesses and which countries suffer more from alcohol-related cases?

_Researcher: Yin Shan Ho_

## Description of Data

The data sets are downloaded from the GISAH tool of the WHO.

The data sets are separated into two parts:

1. The age-standardized death rate in:
- [cancer](https://apps.who.int/gho/data/node.gisah.A1110?lang=en&showonly=GISAH), 
[liver cirrhosis](https://apps.who.int/gho/data/node.gisah.A1092?lang=en&showonly=GISAH),
[road traffic injuries](https://apps.who.int/gho/data/node.gisah.A1077?lang=en&showonly=GISAH).

- The data contains the global observation of the death rate per 100,000 population caused by road injuries, cancers, liver cirrhosis for 194 countries in 2016.

2. The death rate of alcohol attributed cases in: 
- [cancer](https://apps.who.int/gho/data/node.gisah.A1098?lang=en&showonly=GISAH), 
[liver cirrhosis](https://apps.who.int/gho/data/node.gisah.A1094?lang=en&showonly=GISAH),
[road traffic crash](https://apps.who.int/gho/data/node.gisah.A1077?lang=en&showonly=GISAH).

- The data indicates the death rate of alcohol-related road injuries, cancers, liver cirrhosis for 194 countries in 2016.


## Reading the data

This section contains the code to read in data of the number of deaths per 100,000 population and the rate of alcohol attributed deaths caused by cancers, liver cirrhosis and traffic crashes in 2016. 

```{r}
cancer_alcohol <- read_csv("../data/cancer_alcohol.csv")
liver_alcohol <- read_csv("../data/liver_alcohol.csv")
traffic_alcohol <- read_csv("../data/traffic_alcohol.csv")
cancer_death <- read_csv("../data/cancer_death.csv")
liver_death <- read_csv("../data/liver_death.csv")
traffic_death <- read_csv("../data/traffic_death.csv")
```


## Cleaning the data

### Alcohol-attributed deaths

As the research question aims to compare whether alcohol cause more deaths in illnesses or road traffic crashes, several manipulations were done to get the rate of alcohol-attributed deaths. The steps are as follow:

1. Rename the variables 

2. Filter the cells which contain "No data"

3. Pivot longer is used to make data sets longer and to combine the separated variables on gender into one for future calculations. 

```{r clean-cancer-alcohol}
cancer_a <- tail(cancer_alcohol, -2) %>% 
  rename(Country = X1, 
         male = `Alcohol-attributable fractions (15+), cancer deaths`,
         female = `Alcohol-attributable fractions (15+), cancer deaths_1`) %>% 
  filter(!str_detect(male, "No data"))

cancer_a_clean <- pivot_longer(cancer_a, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "alc-attri-death-cancer")
```


```{r clean-liver-alcohol}
liver_a <- tail(liver_alcohol, -2) %>% 
  rename(Country = X1, 
         male = `Alcohol-attributable fractions (15+), liver cirrhosis deaths (%)`,
         female = `Alcohol-attributable fractions (15+), liver cirrhosis deaths (%)_1`) %>% 
  filter(!str_detect(male, "No data"))

liver_a_clean <- pivot_longer(liver_a, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "alc-attri-death-liver")
```


```{r clean-traffic-alcohol}
traffic_a <- tail(traffic_alcohol, -2) %>% 
  rename(Country = X1, 
         male = `Alcohol-attributable fractions (15+), road traffic crash deaths (%)`,
         female = `Alcohol-attributable fractions (15+), road traffic crash deaths (%)_1`) %>% 
  filter(!str_detect(male, "No data"))

traffic_a_clean <- pivot_longer(traffic_a, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "alc-attri-death-traffic")
```


### Number of death per 100,000 population  

To calculate the number of alcohol attributed deaths, the total number of deaths in these three aspects needed to be extracted. 
The way to manipulate this data set is exactly the same as the previous one. 

```{r clean-cancer-death}
cancer_d <- tail(cancer_death, -2) %>% 
  rename(Country = X1, 
         male = `Cancer, age-standardized death rates (15+), per 100,000 population`,
         female = `Cancer, age-standardized death rates (15+), per 100,000 population_1`) %>% 
  filter(!str_detect(male, "No data"))

cancer_d_clean <- pivot_longer(cancer_d, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "cancer-death-population")
```


```{r clean-liver-death}
liver_d <- tail(liver_death, -2) %>% 
  rename(Country = X1, 
         male = `Liver cirrhosis, age-standardized death rates (15+), per 100,000 population`,
         female = `Liver cirrhosis, age-standardized death rates (15+), per 100,000 population_1`) %>% 
  filter(!str_detect(male, "No data"))

liver_d_clean <- pivot_longer(liver_d, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "liver-cirrhosis-death-population")
```


```{r clean-traffic-death}
traffic_d <- tail(traffic_death, -2) %>% 
  rename(Country = X1, 
         male = `Road traffic injuries, age-standardized death rates (15+), per 100,000 population`,
         female = `Road traffic injuries, age-standardized death rates (15+), per 100,000 population_1`) %>% 
  filter(!str_detect(male, "No data"))

traffic_d_clean <- pivot_longer(traffic_d, cols = c("male", "female"),
                                 names_to = "gender",
                                 values_to = "road-traffic-death-population")
```

## Storing the cleaned Data Sets

Saving the data sets into csv:

```{r}
write_csv(cancer_a_clean, "../clean_data/cancer_a_clean.csv")
write_csv(cancer_d_clean, "../clean_data/cancer_d_clean.csv")
write_csv(liver_a_clean, "../clean_data/liver_a_clean.csv")
write_csv(liver_d_clean, "../clean_data/liver_d_clean.csv")
write_csv(traffic_a_clean, "../clean_data/traffic_a_clean.csv")
write_csv(traffic_d_clean, "../clean_data/traffic_d_clean.csv")
```

